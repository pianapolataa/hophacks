<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Data Page with Editable Boxes</title>

    <!-- Google Fonts: Merriweather -->
    <link href="https://fonts.googleapis.com/css2?family=Merriweather:wght@700&display=swap" rel="stylesheet">

    <style>
        :root {
            --dark-blue: #05234a;
            --mid-blue: #0a3d80;
            --page-blue: #a0c4f2;
            --box-bg: #e6eff8;
        }

        body {
            margin: 0;
            font-family: Arial, sans-serif;
            background-color: var(--page-blue);
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            background-color: var(--dark-blue);
            width: 240px;
            height: 100vh;
            display: flex;
            flex-direction: column;
            padding-top: 20px;
            gap: 6px;
        }

        .sidebar button {
            background: none;
            border: none;
            color: white;
            padding: 14px 18px;
            text-align: left;
            font-size: 18px;
            cursor: pointer;
            transition: background 0.2s;
            border-radius: 6px;
            margin: 0 10px;
        }

        .sidebar button:hover {
            background-color: var(--mid-blue);
        }

        .sidebar .home-btn {
            background-color: var(--mid-blue);
            font-weight: 700;
        }

        /* Main content */
        .main-content {
            flex: 1;
            padding: 40px;
        }

        h1 {
            color: var(--dark-blue);
            font-family: 'Merriweather', serif;
            font-size: 48px;
            margin: 0 0 8px 0;
        }

        p.lead {
            margin-top: 6px;
            color: #0b2b4a;
        }

        /* Boxes container */
        .boxes-container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-top: 24px;
        }

        .box {
            background-color: var(--box-bg);
            width: calc(50% - 10px);
            min-height: 150px;
            display: flex;
            flex-direction: column;
            padding: 18px;
            font-size: 18px;
            color: black;
            border-radius: 8px;
            box-sizing: border-box;
            line-height: 1.6;
        }

        .box h2 {
            color: var(--dark-blue);
            font-family: 'Merriweather', serif;
            font-size: 22px;
            margin: 0 0 12px 0;
        }

        .field {
            display: flex;
            justify-content: space-between;
            margin: 6px 0;
        }

        .label {
            font-weight: 500;
        }

        .value {
            margin-left: 20px;
        }

        .box .box-actions {
            margin-top: 12px;
            display: flex;
            gap: 8px;
            justify-content: flex-end;
        }

        .btn {
            padding: 8px 12px;
            border-radius: 6px;
            border: 1px solid rgba(0,0,0,0.08);
            background: white;
            cursor: pointer;
            font-size: 15px;
        }

        .btn.primary {
            background: var(--mid-blue);
            color: white;
            border: none;
        }

        .edit-input {
            padding: 6px 8px;
            border-radius: 6px;
            border: 1px solid #cfd8e6;
            font-size: 15px;
            width: 100%;
        }

        @media (max-width: 800px) {
            .box { width: 100%; }
            .sidebar { width: 180px; }
        }
    </style>
</head>
<body>
    <!-- Sidebar -->
    <div class="sidebar">
        <button onclick="location.href='/'">Home</button>
        <button class="home-btn" onclick="location.href='/data'">Data</button>
        <button onclick="location.href='/experiment'">Experiment</button>
        <button onclick="location.href='/effects'">Side Effects</button>
        <button onclick="location.href='/suggestions'">Dosage Suggestions</button>
    </div>

    <!-- Main content -->
    <div class="main-content">
        <h1>Data</h1>
        <p class="lead">Update information for the patient here.</p>
        <div id="boxes" class="boxes-container"></div>
    </div>

    <script>
        // Default values
        const defaultData = {
            "General Information": {
                Age: 35,
                Sex: "Male",
                BMI: 20.0,
                Diabetes: false
            },
            "Baseline Measurements": {
                "Average daytime resting SBP": 133,
                "Average daytime resting DBP": 80,
                "Baseline heart rate (bpm)": "70"
            },
            "Extra Information": {
                "Sodium Intake (mg)": "2400",
                "Exercise (hours)": "0.5"
            },
            "Current Readings": {
                "SBP": 130,
                "DBP": 81,
                "Heart Rate (BPM)": "72"
            }
        };

        // Load from localStorage if available
        let data = JSON.parse(localStorage.getItem("dataBoxes")) || defaultData;
        // let data = defaultData
        const boxesContainer = document.getElementById("boxes");

        function saveToLocalStorage() {
            localStorage.setItem("dataBoxes", JSON.stringify(data));
        }

        function inputForValue(val) {
            if (typeof val === "boolean") return "checkbox";
            if (typeof val === "number") return "number";
            if (!isNaN(parseFloat(val)) && /^\s*-?\d+(\.\d+)?\s*$/.test(val)) return "number";
            return "text";
        }

        function renderBoxes() {
            boxesContainer.innerHTML = "";
            Object.keys(data).forEach((title) => {
                const box = document.createElement("div");
                box.className = "box";

                const h = document.createElement("h2");
                h.textContent = title;
                box.appendChild(h);

                const content = document.createElement("div");
                Object.entries(data[title]).forEach(([key, value]) => {
                    const field = document.createElement("div");
                    field.className = "field";

                    const label = document.createElement("div");
                    label.className = "label";
                    label.textContent = key;

                    const val = document.createElement("div");
                    val.className = "value";
                    val.textContent = typeof value === "boolean" ? (value ? "Yes" : "No") : value;

                    field.appendChild(label);
                    field.appendChild(val);
                    content.appendChild(field);
                });

                box.appendChild(content);

                const actions = document.createElement("div");
                actions.className = "box-actions";
                const editBtn = document.createElement("button");
                editBtn.className = "btn primary";
                editBtn.textContent = "Edit";
                editBtn.onclick = () => enterEditMode(title, box);
                actions.appendChild(editBtn);
                box.appendChild(actions);

                boxesContainer.appendChild(box);
            });
        }

        function enterEditMode(title, box) {
            box.innerHTML = "";
            const h = document.createElement("h2");
            h.textContent = title;
            box.appendChild(h);

            const formArea = document.createElement("div");
            const inputs = {};

            Object.entries(data[title]).forEach(([key, value]) => {
                const field = document.createElement("div");
                field.className = "field";

                const label = document.createElement("div");
                label.className = "label";
                label.textContent = key;

                let input;
                const type = inputForValue(value);
                if (type === "checkbox") {
                    input = document.createElement("input");
                    input.type = "checkbox";
                    input.checked = value;
                } else {
                    input = document.createElement("input");
                    input.type = type;
                    input.value = value;
                }
                input.className = "edit-input";
                inputs[key] = input;

                const valWrap = document.createElement("div");
                valWrap.className = "value";
                valWrap.appendChild(input);

                field.appendChild(label);
                field.appendChild(valWrap);
                formArea.appendChild(field);
            });

            box.appendChild(formArea);

            const actions = document.createElement("div");
            actions.className = "box-actions";

            const saveBtn = document.createElement("button");
            saveBtn.className = "btn primary";
            saveBtn.textContent = "Save";
            saveBtn.onclick = () => {
                Object.keys(inputs).forEach((key) => {
                    const input = inputs[key];
                    if (input.type === "checkbox") {
                        data[title][key] = input.checked;
                    } else if (input.type === "number") {
                        data[title][key] = input.value === "" ? "" : Number(input.value);
                    } else {
                        data[title][key] = input.value;
                    }
                });
                saveToLocalStorage();
                renderBoxes();
            };

            const cancelBtn = document.createElement("button");
            cancelBtn.className = "btn";
            cancelBtn.textContent = "Cancel";
            cancelBtn.onclick = () => renderBoxes();

            actions.appendChild(cancelBtn);
            actions.appendChild(saveBtn);
            box.appendChild(actions);
        }

        renderBoxes();
    </script>
</body>
</html>
